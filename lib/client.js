
/*
 * simple-autoreload-server v0.0.8 - 2014-02-19
 * <https://github.com/cytb/simple-autoreload-server>
 *
 * Copyright (c) 2014 cytb
 *
 * Licensed under the MIT License License.
 * <http://www.opensource.org/licenses/mit-license.php>
 */

function partialize$(a,b,c){var d=this;return function(){var e,f=slice$.call(arguments),g=f.length,h=c.length,i=b?b.concat():[],j=c?c.concat():[];for(e=0;g>e;++e)i[j[0]]=f[e],j.shift();return h>g&&g?partialize$.apply(d,[a,i,j]):a.apply(d,i)}}var slice$=[].slice,toString$={}.toString,split$="".split;!function(){var a,b,c,d,e,f,g,h,i,j,k;return a=function(b){var c;return c=slice$.call(b),c.reduce(function(b,c){return b.concat("Array"===toString$.call(c).slice(8,-1)&&a(c)||[c])},[])},b=function(a){return document.getElementsByTagName(a)[0]},c=function(a,b){return a.appendChild(document.createElement(b))},d=function(a){return a.parentNode.removeChild(a)},e=function(a){var b,c,d,e,f,g,h,i;for(b=document.createElement(a.tagName.toLowerCase()),c=0,e=(d=a.attributes).length;e>c;++c)f=d[c],g=f.nodeValue,h=f.nodeName,b.setAttribute(h,g);for(c=0,e=(d=a.childNodes).length;e>c;++c)i=d[c],b.appendChild(i);return b},f=function(a,e){var f,g,h,i,j;return f=function(a){var b;return b=document.createElement("a"),b.href=a,b.href},g=function(a,b,c){var d,e;return d=a.href,a.href=b,e=f(c),a.href=d,e},h=b("base"),i=h||c(document.head||b("head"),"base"),j=g(i,a,e),null!=h&&d(i),j},g=function(){function a(b){var e,f,h,i,j,k;if(this.constructor!==a)return b&&new a(b);for(this.source=b,this.relPath=c(b,/(\?|#)(.*)$/),this.absPath=g(this.relPath),this.absDir=d(this.absPath),this.isDir=/\/$/.exec(this.absPath),this.hash=null!=(e=null!=(f=/\#(.*)$/.exec(b))?f[1]:void 0)?e:"",this.queryString=null!=(e=null!=(f=/\?([^#]*)/.exec(b))?f[1]:void 0)?e:"",this.params={},h=0,i=(e=split$.call(this.queryString,"&")).length;i>h;++h)j=e[h],(k=/([^=]+)(?:=(.*))?$/.exec(j))&&(this.params[k[1]]=k[2])}a.displayName="Path";var c,d,e,g,h=a.prototype;return c=function(a,b){var c;return(c=b.exec(a))?a.slice(0,c.index):a},d=partialize$.apply(a,[c,[void 0,/\/[^/]+\/?$/],[0]]),e=function(a){return c(a,/\/[^/]*$/)+"/"},g=function(a){var c,d;return c=(null!=(d=b("base"))?d.href:void 0)||e(location.pathname),f(c,a)},h.includes=function(b){switch(!1){case null!=b:return!1;case b.constructor===this.constructor:return this.includes(new a(b));case!this.isDir:return b.absPath.indexOf(0===_)(this.absPath);default:return function(a){return b.absPath===a}(this.absPath)}},h.toQueryString=function(){var a,b;return function(){var c,d=[];for(a in c=this.params)b=c[a],d.push(a+"="+(null!=b?b:""));return d}.call(this).join("&")},h.toString=function(){var a,b,c;return a=(b=this.toQueryString())?"?"+b:"",c=(b=this.hash)?"#"+b:"",this.relPath+""+a+c},a}(),h=function(b){var c,d,f,h,i,j,k;return c="_tsAccessed",d=g(b.path),f=function(){var b;return b=slice$.call(arguments),a(a(b).map(function(a){return[].slice.call(document.getElementsByTagName(a))}))},h=function(a,c){var e,h,i;return e=function(){var b,d,e,j,k,l,m=[];for(b=0,e=(d=f(a)).length;e>b;++b)for(h=d[b],j=0,l=(k=c).length;l>j;++j)i=k[j],m.push({elem:h,attr:i,path:g(h.getAttribute(i)),set:partialize$.apply(h,[h.setAttribute,[i,void 0],[1]])});return m}().filter(function(a){var b;return b=a.path,d.includes(b)}),0<e.length&&b.forceReload?(location.reload(),[]):e},i=function(a,b,d){return console.debug(a,b.toString()),b.params[c]=Date.now(),d(b.toString())},j=function(a){var b,c,d,e,f,g,j,k=[];for(b=slice$.call(arguments,1),c=0,e=(d=h(a,b)).length;e>c;++c)f=d[c],g=f.path,j=f.set,k.push(i("refresh",g,j));return k},k=function(a){var b,c,d,f,g,j,k,l,m,n,o,p=[];for(b=slice$.call(arguments,1),c=0,f=(d=h(a,b)).length;f>c;++c)g=d[c],j=g.elem,k=g.attr,l=g.path,m=e(j),n=partialize$.apply(m,[m.setAttribute,[k,void 0],[1]]),i("reinsert",l,n),o=j.parentNode,o.insertBefore(m,j),o.removeChild(j),p.push(o);return p},g(location.pathname).absPath===d.absPath&&location.reload(),j(["link"],"href"),j(["audio","img","video","embed","object"],"src"),k(["script"],"src")},i="undefined"!=typeof WebSocket&&null!==WebSocket?WebSocket:"undefined"!=typeof MozWebSocket&&null!==MozWebSocket?MozWebSocket:function(){throw new Error("Autoreload Client - WebSocket is not available on this browser.")},j=window.location,k=new i("ws://"+j.host+j.pathname+"/ws"),k.onopen=function(){return console.log("Autoreload Client - connected to server.")},k.onmessage=function(a){var b,c;return b=a.data,console.debug("message from server",b),c=JSON.parse(b),c&&function(){switch(c.type){case"update":return h(c)}}()},k}();