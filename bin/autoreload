#!/usr/bin/env node

/*
 * simple-autoreload-server v0.0.8 - 2014-02-19
 * <https://github.com/cytb/simple-autoreload-server>
 *
 * Copyright (c) 2014 cytb
 *
 * Licensed under the MIT License License.
 * <http://www.opensource.org/licenses/mit-license.php>
 */

var fs,minimist,options,utils,autoreload,usage,version,toString$={}.toString;fs=require("fs"),minimist=require("minimist"),options=require("../lib/options"),utils=require("../lib/utils"),autoreload=require("../lib/autoreload"),usage=function(){var a,b,c,d,e,f,g,h,i=[];for(a="autoreload",console.log("Usage:"),console.log(" ",a,"[options] [directory] [port]"),console.log(""),console.log("Options:"),b=options.generateCommandlineHelp(),c=0,d=b.length;d>c;++c)e=b[c],f=e[0],g=e[1],h=e[2],console.log("  ",f),console.log("    ",g),null!=h&&console.log("    ","default: "+h),i.push(console.log(""));return i},version=function(){var a,b;return a=utils.load(__dirname,"../package.json"),b=JSON.parse(a),console.log(""+b.name+" v"+b.version)},function(a){return a.call(this)}(function(){var a,b,c,d,e,f,g,h,i,j,k;return a=options.generateMinimistOpt(),b=options.defaultModuleOptions,c=minimist(process.argv.slice(2),a),c.version?(version(),!0):c.help?(version(),console.log(""),usage(),!0):(d=c._,e=null!=(f=d[0])?f:c.root,g=null!=(f=d[1])?f:c.port,h=function(b){var d,e,f,g;d=c[b],e=a["default"][b];try{switch(f=[toString$.call(d).slice(8,-1)],!1){case"String"!==f[0]:return new RegExp(d);case"RegExp"!==f[0]:return d;default:return e}}catch(h){return g=h,e}},i=function(){var a,b,d,e,f,g,h,i,j,k,l,m;for(a=[].concat(c["inject-file"]),b=[].concat(c["inject-method"]),d=[].concat(c["inject-match-text"]),e=[].concat(c["inject-match-file"]),f=[],g=0,h=a.length;h>g;++g)i=a[g],j=e.shift(),null!=i&&null!=j&&(k=null!=(l=d.shift())?l:null,m=!/^a(p(p(e(n(d)?)?)?)?)$/.exec(b.shift()),f=f.concat({code:load(__dirname,i),match:k,file:j,prepend:m}));return f},j=c["no-default-script"]?[]:[b.inject],k=autoreload({root:e,port:g,watch:h("watch"),verbose:c.verbose,forceReload:h("force-reload")||b.forceReload,listDirectory:c["list-directory"],watchDelay:c["watch-delay"],broadcastDelay:c["broadcast-delay"],inject:j.concat(i())}))});